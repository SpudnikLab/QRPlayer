<html>

<head>
    <title>QRPlayer Prototype</title>
    <style>
        body {
            background-color: powderblue;
        }

        #text {
            width: 500px;
        }
    </style>

<body>
    <div id="qr-reader" style="width:500px"></div>
    <div id="qr-reader-results"></div>
    <span id="text"></span>
</body>
<script src="./scripts/html5-qrcode.min.js"></script>
<script type="text/javascript" src="./scripts/pako.min.js"></script>
<script>
    let results = '';

    function docReady(fn) {
        // see if DOM is already available
        if (document.readyState === "complete"
            || document.readyState === "interactive") {
            // call on next available tick
            setTimeout(fn, 1);
        } else {
            document.addEventListener("DOMContentLoaded", fn);
        }
    }

    docReady(function () {
        var resultContainer = document.getElementById('qr-reader-results');
        var lastResult, countResults = 0;
        function onScanSuccess(decodedText, decodedResult) {
            if (decodedText !== lastResult) {
                ++countResults;
                lastResult = decodedText;
                // Handle on success condition with the decoded message.
                results = results.concat(decodedText);
                // Decode base64 (convert ascii to binary)
                var strData = atob(results);

                // Convert binary string to character-number array
                var charData = strData.split('').map(function (x) { return x.charCodeAt(0); });

                // Turn number array into byte-array
                var binData = new Uint8Array(charData);

                // Pako magic
                var data = pako.inflate(binData);

                // Convert gunzipped byteArray back to ascii string:
                var strData = new TextDecoder("utf-8").decode(data);

                document.getElementById("text").innerHTML = strData;
            }
        }

        var html5QrcodeScanner = new Html5QrcodeScanner(
            "qr-reader", { fps: 10, qrbox: 250 });
        html5QrcodeScanner.render(onScanSuccess);
    });
</script>
<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', function () {
            navigator.serviceWorker.register('/scripts/sw.js');
        });
    }
</script>
<!-- <script>
    let svg='<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 69.47 69.47"><defs><style>.cls-1,.cls-5,.cls-7{fill:none;}.cls-2{clip-path:url(#clip-path);}.cls-3{fill:#f39968;}.cls-4{fill:#4bb6ab;}.cls-5,.cls-7{stroke:#063534;stroke-miterlimit:10;stroke-width:2px;}.cls-6{clip-path:url(#clip-path-2);}.cls-7{stroke-linecap:round;}.cls-8{fill:#063534;}.cls-9{fill:#e8e8e8;}</style><clipPath id="clip-path" transform="translate(-0.34 0)"><rect class="cls-1" width="69.81" height="69.5"/></clipPath><clipPath id="clip-path-2" transform="translate(-0.34 0)"><path class="cls-1" d="M11.64,37.52c1.26,6.46,6.7,11.07,16,13.73s15.16-4.34,15.56-4.7.94-6.42-4.46-3.79S26.91,49.51,13,25c0,0-3.13,3.46-1.36,12.55"/></clipPath></defs><title>Favicon</title><g class="cls-2"><path class="cls-3" d="M52.81,69.47H17.34a17,17,0,0,1-17-17V17a17,17,0,0,1,17-17H52.81a17,17,0,0,1,17,17V52.47a17,17,0,0,1-17,17" transform="translate(-0.34 0)"/><path class="cls-4" d="M58.2,30.25a23.55,23.55,0,1,1-46.23,9c-.67-3.45-1.29-8.79-.39-11.12,3.2-8.31,9.7-14.67,19-16.48A23.54,23.54,0,0,1,58.2,30.25" transform="translate(-0.34 0)"/><path class="cls-5" d="M58.2,30.25a23.55,23.55,0,1,1-46.23,9c-.67-3.45-1.29-8.79-.39-11.12,3.2-8.31,9.7-14.67,19-16.48A23.54,23.54,0,0,1,58.2,30.25Z" transform="translate(-0.34 0)"/></g><g class="cls-6"><path class="cls-7" d="M11.58,28.12c-1.38,4.3,12.77,29.16,28.92,16.74" transform="translate(-0.34 0)"/></g><g class="cls-2"><path class="cls-8" d="M48.82,32.51c-1.45,3.79-5.15,5.91-8.27,4.71s-4.46-5.23-3-9,5.15-5.9,8.27-4.71,4.46,5.23,3,9" transform="translate(-0.34 0)"/><path class="cls-9" d="M47.43,28.71a1.69,1.69,0,1,1-1-2.18,1.69,1.69,0,0,1,1,2.18" transform="translate(-0.34 0)"/></g></svg>';
    let deflate=pako.deflate(svg);
    var b64encoded = btoa(String.fromCharCode.apply(null, deflate));
    console.log(b64encoded)
    let u8=new Uint8Array(atob(b64encoded).split("").map(function(c) { return c.charCodeAt(0); }));
    let inflate=pako.inflate(u8);
    var strData = new TextDecoder("utf-8").decode(inflate);
    console.log(strData)
</script> -->
</head>

</html>